#!/usr/bin/env node

if (process.env.NODE_ENV === 'production') {
  require('newrelic');
}

var log = require('winston');
var debug = require('debug')('faccat-crud:server');

// Include the cluster module
var cluster = require('cluster');

var cpuCount = process.env.WEB_CONCURRENCY || require('os').cpus().length;

cluster.setupMaster({exec: 'app.js'});

for (var i = 0; i < cpuCount; i++) 
  cluster.fork();

// Listen for dying workers
cluster.on('exit', function (worker) {
    // Replace the dead worker, we're not sentimental
    log.info('Worker ' + worker.id + ' died :(');
    cluster.fork();
});